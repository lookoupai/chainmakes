# ChainMakes 项目文档

## 概述

ChainMakes 是一个加密货币价差套利交易机器人系统,支持 DCA(Dollar Cost Averaging)倍投策略、自动止盈止损、多机器人并发运行等功能。

## 📌 当前项目状态

**项目阶段**: ✅ 反向开仓功能开发完成,等待测试
**总体进度**: 99%
**最后更新**: 2025-01-XX
**当前状态**: 反向开仓功能已实现,支持正向/反向两种套利策略

**最新进展** (2025-01-XX):
- ✅ 数据库新增 reverse_opening 字段
- ✅ 后端支持正向/反向开仓逻辑
- ✅ 前端完整的配置界面
- ✅ 运行中禁止修改开仓方向
- ✅ 完整的功能文档

**系统现状**:
- ✅ 正向开仓(价差回归策略)
- ✅ 反向开仓(价差扩大策略) - 新增
- ✅ 创建/编辑/详情页面完整支持
- 🚀 等待模拟盘和真实盘测试

详见:**[开发进度 2025-01-XX](DEVELOPMENT_PROGRESS_2025-01-XX.md)** ⭐ 最新

---

## 🚨 新开发者必读

### 推荐阅读顺序

1. **[最新开发进度 (2025-01-XX)](DEVELOPMENT_PROGRESS_2025-01-XX.md)** ⭐⭐⭐ **必读**
   - 反向开仓功能完整实现
   - 支持正向(价差回归)和反向(价差扩大)两种策略
   - 数据库迁移、后端逻辑、前端界面完整实现
   - 详细的使用指南和测试计划
   - 下一步:策略回测功能

2. **[快速开始指南](QUICKSTART.md)** ⭐⭐ **推荐**
   - 5分钟快速搭建开发环境
   - 项目启动和基本使用

3. **[技术架构文档](technical-architecture.md)** ⭐ 推荐
   - 系统架构设计
   - 技术选型说明
   - 模块职责划分

4. **[历史开发进度](archive/)** (可选)
   - 查看过去的开发记录和问题修复

---

## 📚 文档目录

### 🔥 最新文档

| 文档 | 描述 | 适合人群 | 更新日期 |
|------|------|----------|----------|
| **[开发进度 2025-01-XX](DEVELOPMENT_PROGRESS_2025-01-XX.md)** | **📌 反向开仓功能实现** | **所有开发者** | 2025-01-XX |
| [开发进度 2025-10-12](DEVELOPMENT_PROGRESS_2025-10-12.md) | 前端功能完善、用户体验优化 | 所有开发者 | 2025-10-12 |

### 核心文档

| 文档 | 描述 | 适合人群 |
|------|------|----------|
| [快速开始指南](QUICKSTART.md) | 项目快速搭建和基本使用指南 | 新加入的开发者 |
| [技术架构文档](technical-architecture.md) | 系统架构设计和技术选型 | 架构师、开发者 |
| [API 文档](API_DOCUMENTATION.md) | 完整的 API 接口说明和示例 | 前后端开发者 |
| [用户手册](USER_GUIDE.md) | 系统使用说明 | 用户、测试人员 |
| [测试指南](TESTING_GUIDE.md) | 测试规范和测试脚本使用 | 测试人员、开发者 |
| [错误监控指南](ERROR_MONITORING_GUIDE.md) | 错误监控工具使用说明 | 运维/开发者 |
| [OKX 集成指南](OKX_INTEGRATION_GUIDE.md) | OKX 交易所集成说明 | 后端开发者 |

### 部署文档

| 文档 | 描述 | 适合人群 |
|------|------|----------|
| [部署指南](DEPLOYMENT.md) | 生产环境部署方案 | 运维人员 |
| [无 Docker 部署](DEPLOYMENT_WITHOUT_DOCKER.md) | 不使用 Docker 的部署方式 | 运维人员 |
| [VPS Docker 部署](VPS_DOCKER_DEPLOYMENT.md) | VPS 上使用 Docker 部署 | 运维人员 |

### 历史文档

| 文档 | 描述 | 状态 |
|------|------|------|
| [历史开发进度](archive/) | 过去的开发进度记录 | 📦 已归档 |
| [修复记录](fixes/) | 具体问题修复的详细记录 | 📦 已归档 |

---

## 🛠 技术栈

### 后端
- **语言**: Python 3.11+
- **框架**: FastAPI
- **数据库**: PostgreSQL
- **ORM**: SQLAlchemy (异步)
- **认证**: JWT
- **交易所**: OKX (通过 ccxt)
- **实时通信**: WebSocket

### 前端
- **框架**: Vue 3
- **语言**: TypeScript
- **UI库**: Element Plus
- **构建工具**: Vite
- **状态管理**: Pinia
- **HTTP客户端**: Axios

---

## 🚀 核心功能

### ✅ 已完成功能

#### 用户认证系统
- [x] 用户注册、登录
- [x] JWT Token 认证
- [x] 修改邮箱
- [x] 修改密码

#### 交易所集成
- [x] OKX 交易所支持
- [x] API 密钥加密存储
- [x] 模拟盘和真实盘切换
- [x] 网络重试机制
- [x] API 频率控制

#### 机器人核心引擎
- [x] DCA 倍投策略
- [x] 价差监控与计算
- [x] 自动开仓/加仓
- [x] **正向开仓(价差回归策略)**
- [x] **反向开仓(价差扩大策略)** - 新增
- [x] 止盈止损
- [x] 自动平仓
- [x] 总收益统计

#### 数据管理
- [x] 订单记录
- [x] 持仓管理
- [x] 价差历史记录
- [x] 交易日志

#### 实时通信
- [x] WebSocket 推送
- [x] 价差实时更新
- [x] 订单实时更新
- [x] 持仓实时更新

#### 前端界面
- [x] 登录页面
- [x] 仪表盘
- [x] 机器人管理
- [x] 交易所管理
- [x] 用户设置
- [x] 数据可视化

---

## 💻 开发环境要求

- Python 3.11+
- Node.js 18+
- PostgreSQL 14+
- Git

---

## ⚡ 快速开始

### 1. 克隆项目

```bash
git clone <repository-url>
cd chainmakes
```

### 2. 后端启动

```bash
cd backend

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
venv\Scripts\activate  # Windows
source venv/bin/activate  # Linux/Mac

# 安装依赖
pip install -r requirements.txt

# 配置环境变量
cp .env.example .env
# 编辑 .env 文件,配置数据库和 OKX API

# 启动后端服务
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 3. 前端启动

```bash
cd frontend

# 安装依赖
npm install

# 启动前端开发服务器
npm run dev
```

### 4. 访问应用

- 前端: http://localhost:3333
- 后端 API: http://localhost:8000
- API 文档: http://localhost:8000/docs
- 默认账户: `admin` / `admin123`

**首次登录后请立即修改密码**(右上角 → 账户设置 → 修改密码)

---

## 📁 项目结构

```
chainmakes/
├── backend/                      # 后端服务
│   ├── app/
│   │   ├── api/v1/              # API 路由
│   │   ├── core/                # 核心引擎
│   │   ├── exchanges/           # 交易所适配
│   │   ├── models/              # 数据模型
│   │   ├── services/            # 业务逻辑
│   │   └── utils/               # 工具函数
│   └── requirements.txt
├── frontend/                    # 前端应用
│   ├── src/
│   │   ├── pages/              # 页面组件
│   │   ├── common/             # 公共组件
│   │   ├── router/             # 路由配置
│   │   └── pinia/              # 状态管理
│   └── package.json
├── docs/                        # 项目文档
│   ├── README.md               # 本文档
│   ├── DEVELOPMENT_PROGRESS_2025-10-12.md  # 最新进度
│   ├── archive/                # 历史文档
│   └── fixes/                  # 修复记录
└── docker-compose.yml
```

---

## 📊 下一步开发计划

### 优先级:最高 🔴

#### 1. 真实盘测试

**测试计划**:

**阶段 1: 小额测试**(1-3天)
- 投资额:50-100 USDT
- 杠杆:2-3x
- DCA 次数:最多2次
- 目标:验证核心逻辑正确性

**阶段 2: 中等金额测试**(1周)
- 投资额:500-1000 USDT
- 杠杆:3-5x
- DCA 次数:最多3次
- 目标:验证稳定性和盈利能力

**阶段 3: 正式运行**
- 根据测试结果调整参数
- 逐步增加投资金额

**检查清单**:
- [x] 网络稳定性验证
- [x] API 频率控制测试
- [x] 自动平仓功能验证
- [x] 持仓数据准确性验证
- [x] 用户密码修改功能
- [ ] 小额真实盘测试(50-100 USDT)
- [ ] 风险控制参数确认
- [ ] 止损止盈逻辑验证

### 优先级:高 🟡

#### 2. 用户体验优化
- [ ] 添加机器人运行状态通知
- [ ] 添加盈亏警报功能
- [ ] 优化移动端适配
- [ ] 添加暗黑模式支持

#### 3. 数据分析功能
- [ ] 交易历史分析
- [ ] 盈亏趋势图表
- [ ] 策略效果对比
- [ ] 导出交易报表

### 优先级:中 🔵

#### 4. WebSocket 优化
- [ ] 订阅价格推送
- [ ] 订阅持仓推送
- [ ] 订阅订单推送
- [ ] 预期效果:API 请求量再降低 50%

#### 5. 多交易所支持
- [ ] Binance(币安)
- [ ] Bybit
- [ ] Gate.io

详情请查看 [最新开发进度 2025-10-12](DEVELOPMENT_PROGRESS_2025-10-12.md)。

---

## 🧪 测试命令

### 后端测试

```bash
cd backend

# 认证测试
python scripts/test_auth.py

# WebSocket 测试
python scripts/test_websocket_simple.py

# 完整功能测试
python scripts/test_websocket_full.py

# 机器人启动测试
python scripts/test_bot_start.py
```

---

## 🐛 问题排查

### 常见问题

**1. 机器人不启动**
- 检查交易所账户是否有效
- 检查 API 密钥是否正确
- 查看后端日志 `logs/app.log`

**2. 前端无法连接后端**
- 检查后端是否运行(http://localhost:8000/docs)
- 检查 CORS 配置
- 检查 `.env` 中的 API 地址

**3. 订单不成交**
- 检查交易对是否正确
- 检查杠杆是否设置
- 查看交易所是否有足够余额

**4. WebSocket 断连**
- 检查网络连接
- 查看浏览器控制台错误
- 重启机器人

---

## 📞 贡献指南

### 提交规范

```bash
# 功能开发
git commit -m "feat: 添加机器人自动重启功能"

# Bug 修复
git commit -m "fix: 修复 WebSocket 断线重连问题"

# 文档更新
git commit -m "docs: 更新 API 文档"

# 性能优化
git commit -m "perf: 优化数据库查询性能"

# 代码重构
git commit -m "refactor: 重构交易引擎核心逻辑"

# 样式调整
git commit -m "style: 优化导航菜单图标和命名"
```

---

## 📈 项目里程碑

- [x] 2025-10-04: 项目初始化
- [x] 2025-10-05: 基础框架搭建
- [x] 2025-10-06: Mock 交易所实现
- [x] 2025-10-07: OKX 集成完成
- [x] 2025-10-08: 错误监控工具
- [x] 2025-10-10: 核心 Bug 修复和功能完善
- [x] 2025-10-11: 系统稳定性优化
- [x] 2025-10-12: 前端功能完善与用户体验优化
- [x] **2025-01-XX: 反向开仓功能实现** ← **当前**
- [ ] **下一步: 策略回测功能**

---

## 📄 许可证

本项目采用 MIT 许可证。

---

## 👥 联系信息

- **项目开始时间**: 2025-10-04
- **文档版本**: v6.0 (反向开仓功能版)
- **最后更新**: 2025-01-XX

---

**项目状态**: 🎉 **反向开仓功能已完成,支持双策略套利!**
